---
title: "Pulumiã§AWSÃ—Goã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚„ã£ãŸ"
emoji: "ğŸš€"
type: "tech"
topics: ["aws", "go", "pulumi"]
published: true
---

# Pulumi ã¨ã¯

Terraform ãªã©ã«ä»£è¡¨ã•ã‚Œã‚‹ IaC(Infrastructure as Code)ãƒ„ãƒ¼ãƒ«ã®ã²ã¨ã¤ã€‚
https://www.pulumi.com/

> Pulumi is a modern infrastructure as code platform that allows you to use familiar programming languages and tools to build, deploy, and manage cloud infrastructure.
> (è¨³:Pulumi ã¯ã€ä½¿ã„æ…£ã‚ŒãŸãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã‚„ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦ã€ã‚¯ãƒ©ã‚¦ãƒ‰åŸºç›¤ã®æ§‹ç¯‰ã€ãƒ‡ãƒ—ãƒ­ã‚¤ã€ç®¡ç†ã‚’å¯èƒ½ã«ã™ã‚‹ã€æœ€æ–°ã® Infrastructure as Code ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚)

ç¾åœ¨ TypeScript,JavaScript,Python,Go,C#ã«å¯¾å¿œã—ã¦ã„ã‚‹ã‚ˆã†ã§ã€ä¾‹ãˆã° Terraform ã ã¨ HCL(HashiCorp Configuration Language)ã¨ã„ã†ç‹¬è‡ªã®è¨€èªã§è¨˜è¿°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸãŒã€Pulumi ã§ã¯ä¸Šè¨˜ã®å¥½ããªè¨€èªã§è¨˜è¿°ã§ãã‚‹ãã†ã§ã™ã€‚

è‡ªåˆ†ã¯ 1 ãƒ¶æœˆåŠãã‚‰ã„å‰ã«ã¯ã˜ã‚ã¦ IaC,Terraform ã«è§¦ã‚Šã€ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ä½œæˆã—ãŸä¸­è¦æ¨¡ãã‚‰ã„ã® AWS ãƒªã‚½ãƒ¼ã‚¹ã‚’è¤‡è£½ã™ã‚‹ä½œæ¥­ã‚’è¡Œã„ã¾ã—ãŸã€‚æ­£ç›´ HCL ã®å­¦ç¿’ã‚³ã‚¹ãƒˆã¯ãã“ã¾ã§é«˜ããªã‹ã£ãŸã‚“ã§ã™ãŒã€å…¥åŠ›è£œå®ŒãŒå°‘ã—ä½¿ã„ã¥ã‚‰ã‹ã£ãŸã‚Šã—ãŸã®ã§ã€ä»Šã¾ã§é€šã‚Šã® IDE ã®è£œå®Œæ©Ÿèƒ½ä½¿ãˆã‚‹ãªã‚‰ä¾¿åˆ©ãã†ï¼ã¨ã„ã†ã“ã¨ã§è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚Pulumi ã¯ Terraform ã® Provider ã‚’ãƒ©ãƒƒãƒ—ã—ã¦ãŠã‚Šã€å†…éƒ¨ã§ã¯ Terraform ãŒå‹•ã„ã¦ã„ã‚‹ã€ã¨ã„ã†æƒ…å ±ã‚‚ã¡ã‚‰ã»ã‚‰è¦‹ã‹ã‘ã‚‹ã®ã§ã™ãŒã€ã‚½ãƒ¼ã‚¹ãŒ~~æ¢ã—ã¦ãªã„~~è¦‹ã¤ã‘ã‚‰ã‚Œãªã‹ã£ãŸã®ã§ã‚ˆãã‚ã‹ã‚Šã¾ã›ã‚“!!!!

# æº–å‚™ã—ã¦ãŠãã‚‚ã®

- AWS ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
- `s3:CreateBucket`æ¨©é™ã‚’ä»˜ä¸ã—ãŸ Pulumi ç”¨ IAM ãƒ¦ãƒ¼ã‚¶ãƒ¼(ã¨ã‚Šã‚ãˆãšã–ã£ãã‚Šè§¦ã‚‹ã ã‘ãªã‚‰æ™®æ®µä½¿ã£ã¦ã‚‹ IAM ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½¿ã„ã¾ã‚ã—ã¡ã‚ƒã£ã¦ã„ã„ã¨æ€ã„ã¾ã™)

`aws configure`ã‚³ãƒãƒ³ãƒ‰ã§ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã‚’ç™»éŒ²ã—ã¦ãŠãã‹ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ç’°å¢ƒå¤‰æ•°ã«ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã‚’ç™»éŒ²ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚

```bash
$ export AWS_ACCESS_KEY_ID=<YOUR_ACCESS_KEY_ID>
$ export AWS_SECRET_ACCESS_KEY=<YOUR_SECRET_ACCESS_KEY>
```

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

https://www.pulumi.com/docs/get-started/aws/begin/

asdf ã«ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒã‚ã£ãŸã®ã§ã€è‡ªåˆ†ã¯ asdf ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ãŸã€‚

- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ¤œç´¢

```bash
$ asdf plugin list-all | grep pulumi
pulumi                        https://github.com/canha/asdf-pulumi.git
```

- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®è¿½åŠ 

```bash
$ asdf plugin add pulumi
```

- æœ€æ–°ç‰ˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
$ asdf install pulumi latest
```

- global ã§ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³è¨­å®š

```bash
$ asdf global pulumi latest
```

- ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª

```bash
$ pulumi version
v3.21.1
```

ä½¿ç”¨ã™ã‚‹è¨€èªã«ã¤ã„ã¦ã‚‚ã€åˆ¥é€”ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ï¼

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

æ¬¡ã«ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚

ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã¯ãŠå¥½ããªã‚‚ã®ã§ã€aws-go ã¯ä½¿ã„ãŸã„è¨€èªã«ã‚ˆã£ã¦ aws-typescript ã¨ã‹ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

åˆå›ã¯ Pulumi ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¸ã®ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ã‚’æ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚ãƒˆãƒ¼ã‚¯ãƒ³ã®å…¥åŠ›ã‚’æ±‚ã‚ã‚‰ã‚ŒãŸã‚‰ãã®ã¾ã¾ Enter ã‚’æŠ¼ã™ã¨ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ç”»é¢ãŒé–‹ãã®ã§ã€ãŠå¥½ããªæ–¹æ³•ã§ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ã—ã¾ã—ã‚‡ã†ã€‚

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã¨èª¬æ˜æ–‡ã€ã‚¹ã‚¿ãƒƒã‚¯åã¯ä¸€æ—¦ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã€è‡ªåˆ†ã®å ´åˆã¯æ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œã‚ŠãŸã‹ã£ãŸã®ã§ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ã¿ ap-northeast-1 ã«è¨­å®šã—ã¾ã—ãŸã€‚

```bash
$ mkdir pulumi-tutorial && cd pulumi-tutorial
$ pulumi new aws-go
Manage your Pulumi stacks by logging in.
Run `pulumi login --help` for alternative login options.
Enter your access token from https://app.pulumi.com/account/tokens
    or hit <ENTER> to log in using your browser                   :
We've launched your web browser to complete the login process.

Waiting for login to complete...


  Welcome to Pulumi!

  Pulumi helps you create, deploy, and manage infrastructure on any cloud using
  your favorite language. You can get started today with Pulumi at:

      https://www.pulumi.com/docs/get-started/

  Tip of the day: Resources you create with Pulumi are given unique names (a randomly
  generated suffix) by default. To learn more about auto-naming or customizing resource
  names see https://www.pulumi.com/docs/intro/concepts/resources/#autonaming.


This command will walk you through creating a new Pulumi project.

Enter a value or leave blank to accept the (default), and press <ENTER>.
Press ^C at any time to quit.

project name: (pulumi-tutorial)
project description: (A minimal AWS Go Pulumi program)
Created project 'pulumi-tutorial'

Please enter your desired stack name.
To create a stack in an organization, use the format <org-name>/<stack-name> (e.g. `acmecorp/dev`).
stack name: (dev)
Created stack 'dev'

aws:region: The AWS region to deploy into: (us-east-1) ap-northeast-1
Saved config

Installing dependencies...
--- çœç•¥ ---
Finished installing dependencies

Your new project is ready to go! âœ¨

To perform an initial deployment, run 'pulumi up'
```

ã™ã‚‹ã¨ã€go.mod,go.sum,main.go ã®ä»–ã«ã€Pulumi.dev.yaml,Pulumi.yaml ãŒç”Ÿæˆã•ã‚Œã¦ã„ã¾ã™ã€‚

Pulumi ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ 1 ã¤ä»¥ä¸Šã®ã‚¹ã‚¿ãƒƒã‚¯ã‹ã‚‰å½¢æˆã•ã‚Œã¦ãŠã‚Šã€ä¾‹ãˆã°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒ todo-app ã§ã‚¹ã‚¿ãƒƒã‚¯ãŒ dev,staging,production ã¨ã„ã£ãŸæ„Ÿã˜ã®ã‚ˆã†ã§ã™ã­ã€‚Pulumi.yaml ãŒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã€Pulumi.dev.yaml ãŒ dev ã‚¹ã‚¿ãƒƒã‚¯ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã€ã¨ã„ã£ãŸæ„Ÿã˜ã§ã™ã€‚

https://www.pulumi.com/docs/intro/concepts/

# ãƒªã‚½ãƒ¼ã‚¹ã®ä½œæˆ

ãã—ã¦ main.go ã«ã¯æ—¢ã« S3 ãƒã‚±ãƒƒãƒˆã®å®šç¾©ã‚‰ã—ãã‚‚ã®ãŒè¨˜è¿°ã•ã‚Œã¦ã„ã¾ã™ï¼

```go:main.go
package main

import (
	"github.com/pulumi/pulumi-aws/sdk/v4/go/aws/s3"
	"github.com/pulumi/pulumi/sdk/v3/go/pulumi"
)

func main() {
	pulumi.Run(func(ctx *pulumi.Context) error {
		// Create an AWS resource (S3 Bucket)
		bucket, err := s3.NewBucket(ctx, "my-bucket", nil)
		if err != nil {
			return err
		}

		// Export the name of the bucket
		ctx.Export("bucketName", bucket.ID())
		return nil
	})
}
```

è¨€ã‚ã‚Œã‚‹ãŒã¾ã¾ pulumi up ã™ã‚‹ã¨...

```bash
$ pulumi up
Previewing update (dev)

View Live: https://app.pulumi.com/keyamin/pulumi-tutorial/dev/previews/78f18ce4-47a2-4114-8b19-824b53a1b9a9

[resource plugin aws-4.30.0] installing
Downloading plugin: 96.35 MiB / 96.35 MiB [========================] 100.00% 13s
     Type                 Name                 Plan
 +   pulumi:pulumi:Stack  pulumi-tutorial-dev  create
 +   â””â”€ aws:s3:Bucket     my-bucket            create

Resources:
    + 2 to create

Do you want to perform this update?  [Use arrows to move, enter to select, type to fi
Do you want to perform this update? yes
Updating (dev)

View Live: https://app.pulumi.com/keyamin/pulumi-tutorial/dev/updates/1

     Type                 Name                 Status
 +   pulumi:pulumi:Stack  pulumi-tutorial-dev  created
 +   â””â”€ aws:s3:Bucket     my-bucket            created

Outputs:
    bucketName: "my-bucket-81deda3"

Resources:
    + 2 created

Duration: 7s
```

ã“ã‚Œã ã‘ã§ S3 ãƒã‚±ãƒƒãƒˆãŒä½œæˆã•ã‚Œã¾ã—ãŸï¼

# ãƒªã‚½ãƒ¼ã‚¹ã®å‰Šé™¤

ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã¯ã“ã“ã« html ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®ã—ã€åŒã˜ã pulumi up ã§å¤‰æ›´ã‚’åæ˜ ã—ã¦ã„ã¾ã™ãŒã€ä¸€æ—¦ destroy ã‚‚è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```bash
$ pulumi destroy
Previewing destroy (dev)

View Live: https://app.pulumi.com/keyamin/pulumi-tutorial/dev/previews/fb08aabe-03f7-4ebc-b29d-f3561ed115a7

     Type                 Name                 Plan
 -   pulumi:pulumi:Stack  pulumi-tutorial-dev  delete
 -   â””â”€ aws:s3:Bucket     my-bucket            delete

Outputs:
  - bucketName: "my-bucket-81deda3"

Resources:
    - 2 to delete

Do you want to perform this destroy?  [Use arrows to move, enter to select, t
Do you want to perform this destroy?  [Use arrows to move, enter to select, t
Do you want to perform this destroy? yes
Destroying (dev)

View Live: https://app.pulumi.com/keyamin/pulumi-tutorial/dev/updates/2

     Type                 Name                 Status
 -   pulumi:pulumi:Stack  pulumi-tutorial-dev  deleted
 -   â””â”€ aws:s3:Bucket     my-bucket            deleted

Outputs:
  - bucketName: "my-bucket-81deda3"

Resources:
    - 2 deleted

Duration: 3s

The resources in the stack have been deleted, but the history and configuration associated with the stack are still maintained.
If you want to remove the stack completely, run 'pulumi stack rm dev'.
```

S3 ãƒã‚±ãƒƒãƒˆãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸï¼

ã“ã®è¾ºã®ä½¿ã„å‹æ‰‹ã¯ Terraform ã¨ä¸€ç·’ã§ã™ã­ã€‚

# å®Ÿè¡Œè¨ˆç”»ã®ç¢ºèª

pulumi preview ã§ terraform plan ç›¸å½“ã® Dry Run ãŒã§ãã¾ã™ã€‚

```bash
$ pulumi preview
Previewing update (dev)

View Live: https://app.pulumi.com/keyamin/pulumi-tutorial/dev/previews/53971b46-1fef-431d-850e-265a3fb91087

     Type                 Name                 Plan
 +   pulumi:pulumi:Stack  pulumi-tutorial-dev  create
 +   â””â”€ aws:s3:Bucket     my-bucket            create

Resources:
    + 2 to create
```

# ã¾ã¨ã‚

ä»Šå›ã¯ç°¡å˜ã« S3 ãƒã‚±ãƒƒãƒˆã®ä½œæˆã®ã¿ã‚„ã£ã¦ã¿ã¾ã—ãŸãŒã€VSCode ä¸Šã§æ™®æ®µã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¨åŒã˜ã‚ˆã†ã«å‹å®šç¾©ã«ã‚¸ãƒ£ãƒ³ãƒ—ã—ãŸã‚Šã§ãã¦æ„Ÿå‹•ã—ã¾ã—ãŸ...

æœ€åˆã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²ã—ãŸ Pulumi ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚‚ã‹ãªã‚Šè¦‹ã‚„ã™ãã€å…¨ä½“ã‚’é€šã—ã¦ä½¿ã„ãŸããªã‚Šã¾ã™ï¼

ä»Šå›ã¯è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸã‚‚ã®ã‚’ãã®ã¾ã¾ up ã—ãŸã ã‘ã§ã€pulumi ã‚³ãƒãƒ³ãƒ‰ã‚‚ä»Šå›ä½¿ã£ãŸã‚‚ã®ä»¥å¤–ã«ã‚‚çµæ§‹ç¨®é¡ãŒã‚ã‚Šãã†ãªã®ã§ã€å®Ÿè·µã—ãªãŒã‚‰ã„ã‚ã„ã‚è¦šãˆã¦ã„ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ã€‚

ã§ã¯ãƒ¼ãƒ¼ãƒ¼
