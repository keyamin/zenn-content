---
title: "Goã§ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã‚’å—ã‘å–ã‚‹"
emoji: "ğŸ¹"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["go"]
published: true
---

# ã¯ã˜ã‚ã«

Go ã§ `go run main.go` ã™ã‚‹ã¨ãã®å¼•æ•°ã‚’æ‰±ã„ãŸã‹ã£ãŸã®ã§ã€ãã®å®Ÿè£…ã®éç¨‹ã®å‚™å¿˜éŒ²ã§ã™ã€‚
.env ãƒ•ã‚¡ã‚¤ãƒ«ã¾ãŸã¯ç’°å¢ƒå¤‰æ•°ã®å®šç¾©ãŒã•ã‚Œã¦ã„ã‚Œã°ãã‚Œã‚‚ä½¿ç”¨ã—ã€å„ªå…ˆåº¦é †ã§ã¯ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•° > .env > ç’°å¢ƒå¤‰æ•°ã®é †ã«ã—ãŸã‹ã£ãŸã®ã§ãã®ã‚ˆã†ãªå®Ÿè£…ã‚’ç›®æŒ‡ã—ã¾ã—ãŸã€‚

# å®Ÿè£…éç¨‹

## ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã‚’å—ã‘å–ã‚‹

Go ã§ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã‚’å–å¾—ã™ã‚‹æ–¹æ³•ã¯ `os.Args` ã¨ `flag` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã® 2 é€šã‚ŠãŒã‚ã‚‹ãã†ã§ã™ã€‚
ç°¡å˜ã‹ã¤ã§ãã‚‹ã“ã¨ã‚‚å¤šãã†ãªã®ã§ `flag` ã‚’é¸æŠã—ã¾ã—ãŸï¼

å‚è€ƒè¨˜äº‹:
https://qiita.com/nakaryooo/items/2d0befa2c1cf347800c3

ä½¿ã„æ–¹ã¨ã—ã¦ã¯ã€

- `flag.String()`ãªã©ã«å¼•æ•°åã€åˆæœŸå€¤ã€èª¬æ˜ã®é †ã«æ¸¡ã—ã¦ flag ã‚’å®šç¾©
- `flag.Parse()`ã§è§£æ
- å¤‰æ•°ã«ã¯ãƒã‚¤ãƒ³ã‚¿ãŒå…¥ã£ã¦ã‚‹ã®ã§ã€å®Ÿä½“ã‚’å–ã‚Šå‡ºã™

ã¨ã„ã£ãŸæ„Ÿã˜ã«ãªã‚Šã¾ã™ã€‚`flag.Args()`ã§åå‰ãŒã¤ã„ã¦ãªã„å¼•æ•°ã‚‚å—ã‘å–ã‚Œã¾ã™ã—ã€[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://pkg.go.dev/flag)ã‚’è¦‹ã‚‹ã¨ã„ã‚ã‚“ãªãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«å¯¾å¿œã—ã¦ãã†ã§ã™ã€‚

```go
func init() {
    var name = flag.String("name","John","User name.")
    flag.Parse()
    fmt.Println(*name) // -> Johnã¾ãŸã¯å®Ÿè¡Œæ™‚ã«-name=ã§æ¸¡ã—ãŸå¼•æ•°
}
```

ã‚³ãƒãƒ³ãƒ‰ã¯

```sh
$ go run main.go -name=Bob
```

ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚ãƒã‚¤ãƒ•ãƒ³ã¯ 1 ã¤ã§ã‚‚ 2 ã¤ã§ã‚‚ã‚ˆãã€boolean ã§ãªã„ãƒ•ãƒ©ã‚°ãªã‚‰=ã‚‚ãªãã¦ã„ã„ã¿ãŸã„ã§ã™ã€‚

é‡è¦ãªã®ã¯ flag ã‚’å®šç¾©ã—ãŸã‚ã¨ã« flag.Parse()ã‚’å‘¼ã³å‡ºã™ã“ã¨ã§ã€ã‚³ãƒ¼ãƒ‰å†…ã§ã¯å•é¡Œãªãã¦ã‚‚ã€ä¸Šã®ä¾‹ã®ã‚ˆã†ã«`init()`é–¢æ•°ã§ flag ã®è§£æã‚’è¡Œã£ã¦ã„ã‚‹å ´åˆã€`go test`ã—ãŸã¨ãã«ãƒ†ã‚¹ãƒˆãƒ•ãƒ©ã‚°ã®å‡¦ç†ãŒãƒ†ã‚¹ãƒˆç”¨ã«ç”Ÿæˆã•ã‚ŒãŸ main é–¢æ•°ã§è¡Œã‚ã‚Œã‚‹ãŸã‚ã€ãã‚Œã‚ˆã‚Šå…ˆã«å‘¼ã³å‡ºã•ã‚Œã‚‹`init()`å†…ã® flag.Parse()ãŒå‘¼ã°ã‚ŒãŸæ™‚ç‚¹ã§ãƒ†ã‚¹ãƒˆãƒ•ãƒ©ã‚°ã®è§£æãŒã§ããªããªã£ã¦ã—ã¾ã„ã€ãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã›ã‚“ã€‚
ã“ã®å•é¡Œã«é–¢ã—ã¦ã¯`init()`é–¢æ•°ã®å…ˆé ­ã§æ˜ç¤ºçš„ã«`testing.Init()`ã‚’å‘¼ã³å‡ºã™ã“ã¨ã§è§£æ¶ˆã§ãã¾ã™ã€‚

å‚è€ƒè¨˜äº‹:
https://syfm.hatenablog.com/entry/2019/10/01/063436

## .env ãƒ•ã‚¡ã‚¤ãƒ«ã§å®šç¾©ã—ãŸç’°å¢ƒå¤‰æ•°ã‚’å—ã‘å–ã‚‹

[godotenv](https://github.com/joho/godotenv)ã‚’ä½¿ã„ã€.envãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚

ãŸã ã—ã€é€šå¸¸é€šã‚Š`godotenv.Load()`ã§èª­ã¿è¾¼ã‚€ã¨å…ƒã‹ã‚‰å­˜åœ¨ã™ã‚‹ç’°å¢ƒå¤‰æ•°ãŒå„ªå…ˆã•ã‚Œã‚‹ãŸã‚ã€ä»Šå›ã®å ´åˆ`godotenv.Overload()`ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```go
// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã®.envãŒèª­ã¾ã‚Œã‚‹ã€‚
// å¼•æ•°ã«ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æ¸¡ã›ã°.env.developmentãªã©ã®ä½¿ã„åˆ†ã‘ã‚‚å¯èƒ½ã€‚
godotenv.Overload()
```

## ç’°å¢ƒå¤‰æ•°ã‚’å—ã‘å–ã‚‹

ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã®`os`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã£ã¦ç’°å¢ƒå¤‰æ•°ã‚’èª­ã¿è¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚

```go
// ç’°å¢ƒå¤‰æ•° HOGE ã‚’èª­ã¿è¾¼ã‚€
hoge := os.Getenv("HOGE")
```

ã¾ãŸã€ç’°å¢ƒå¤‰æ•°ã®ã‚»ãƒƒãƒˆã‚„ã€å­˜åœ¨ãƒã‚§ãƒƒã‚¯ã‚‚è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

```go
// ç’°å¢ƒå¤‰æ•° HOGE ã« "hoge" ã‚’ã‚»ãƒƒãƒˆ
os.Setenv("HOGE","hoge")

// ç’°å¢ƒå¤‰æ•° HOGE ã«æ—¢ã«å€¤ãŒã‚»ãƒƒãƒˆã•ã‚Œã¦ã„ã‚Œã° hoge ã«ä»£å…¥ã•ã‚Œã€ ok ã« true ãŒå…¥ã‚‹
// ã‚»ãƒƒãƒˆã•ã‚Œã¦ã„ãªã‘ã‚Œã°hogeã«ã¯ç©ºæ–‡å­—ã€okã«falseãŒå…¥ã‚‹
hoge,ok := os.LookupEnv("HOGE")
```

## ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•° > .env > ç’°å¢ƒå¤‰æ•°ã®å„ªå…ˆé †ä½ã§èª­ã¿è¾¼ã‚€

ã“ã‚Œã‚‰ã®æ–¹æ³•ã‚’é§†ä½¿ã—ã¦ã€ã“ã‚“ãªæ„Ÿã˜ã§å®Ÿè£…ã—ã¦ã¿ã¾ã—ãŸï¼

```go
func init(){
    const (
        hogeKey = "HOGE"
    )
    var (
        hogeValue = flag.String(hogeKey, "", "hoge.")
    )

    flag.Parse()
    godotenv.Overload()

    m := map[string]string{
        hogeKey: *hogeValue,
    }

    for k, v := range m {
        if err := overrideEnv(k, v); err != nil {
            panic(err)
        }
    }
}

// ä¸ãˆã‚‰ã‚ŒãŸã‚­ãƒ¼ã®ç’°å¢ƒå¤‰æ•°ã‚’ä¸ãˆã‚‰ã‚ŒãŸæ–‡å­—åˆ—ã§ä¸Šæ›¸ãã—ã¾ã™ã€‚
// å…ƒã®ç’°å¢ƒå¤‰æ•°ã¨ä¸Šæ›¸ãã™ã‚‹ç’°å¢ƒå¤‰æ•°ã©ã¡ã‚‰ã‚‚å­˜åœ¨ã—ãªã„å ´åˆã€errorã‚’è¿”ã—ã¾ã™ã€‚
func overrideEnv(key, value string) error {
	if value != "" {
		os.Setenv(key, value)
		return nil
	} else if _, ok := os.LookupEnv(key); !ok {
		return fmt.Errorf("%sã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚(-%s=<VALUE>)", key, key)
	}
	return nil
}
```

# ã¾ã¨ã‚

`flag`ã«é–¢ã—ã¦ã¯æä¾›ã•ã‚Œã¦ã„ã‚‹é–¢æ•°ãŒå¤šãã€ä»–ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã§ã‚‚è©¦ã—ã¦ã¿ãŸã„ãªã¨æ€ã„ã¾ã—ãŸã€‚

`godotenv`ã«é–¢ã—ã¦ã‚‚.env.developmentã¿ãŸã„ãªå®Ÿè·µçš„ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã‚‚ä½¿ã£ã¦ã¿ãŸã„ã§ã™ï¼

ã§ã¯ãƒ¼ãƒ¼ãƒ¼
